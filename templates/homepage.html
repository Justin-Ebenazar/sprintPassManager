<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Dashboard | Password Manager</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='home_style.css') }}">
</head>

<body>
    <header class="top-bar">
        <div style="display: flex; align-items: center;">
            <input type="text" id="search-box" placeholder="Search apps...">
        </div>
        <div class="top-actions">
            <button onclick="openProfile()">Profile</button>
            <button onclick="openLogoutConfirm()">Logout</button>
        </div>
    </header>

    <main class="app-grid">
        {% for app in credential %}
        <div class="app-card" data-app-name="{{ app.app_name | lower }}">
            <button class="app-button"
                onclick="openOverlay('{{ app.app_name }}', '{{ app.username }}', '{{ app.password }}', '{{ app.email }}', '{{ app.phone }}')">
                <img src="{{ url_for('static', filename='icons/' + app.icon_filename) }}" alt="{{ app.app_name }} Icon">
                <span>{{ app.app_name }}</span>
            </button>
            <div class="app-actions" style="margin-top: 10px;">
                <button style="padding: 3px 2px 1px 2px; margin: 0; border-radius: 5px;"
                    onclick="openEditOverlay('{{ app.id }}','{{ app.app_name }}', '{{ app.username }}', '{{ app.password }}', '{{ app.email }}', '{{ app.phone }}', '{{ app.icon_filename }}')">
                    <img class="edit" src="{{ url_for('static', filename='builtIcons/pencil-svg.svg') }}" alt="Logout"
                        style="width: 15px; height: 15px; ">
                </button>
                <button style="padding: 3px 2px 1px 2px; margin: 0; border-radius: 5px;" onclick="openDeleteConfirm('{{ app.id }}','{{ app.app_name }}')">
                    <img class="delete" src="{{ url_for('static', filename='builtIcons/trash-svg.svg') }}" alt="Logout"
                        style="width: 15px; height: 15px; ">
                </button>
            </div>
        </div>
        {% endfor %}
    </main>

    <button class="add-button" onclick="openAddOverlay()">+</button>

    <div id="app-overlay" class="overlay hidden">
        <div class="overlay-content">
            <h3 id="overlay-app-name"></h3>
            <p><strong>Username:</strong> <span id="overlay-username"></span></p>
            <p><strong>Password:</strong> <span id="overlay-password"></span></p>
            <p><strong>Email:</strong> <span id="overlay-email"></span></p>
            <p><strong>Phone:</strong> <span id="overlay-phone"></span></p>
            <div class="overlay-actions">
                <button onclick="copyPassword()">Copy Password</button>
                <button onclick="closeOverlay()">Close</button>
            </div>
        </div>
    </div>

    <div id="profile-overlay" class="overlay hidden">
        <div class="overlay-content">
            <h3>Your Profile</h3>
            <p><strong>Username:</strong> {{ session['user'] }}</p>
            <div class="overlay-actions">
                <button onclick="closeProfile()">Close</button>
            </div>
        </div>
    </div>

    <div id="add-overlay" class="overlay hidden">
        <div class="overlay-content">
            <h3>Add New Credential</h3>
            <form method="POST" action="/add">
                <label>App Name</label>
                <input type="text" name="app_name" required>
                <label>Username</label>
                <input type="text" name="username" required>
                <label>Password</label>
                <input type="text" name="password" required>
                <label>Email</label>
                <input type="email" name="email">
                <label>Phone</label>
                <input type="text" name="phone">
                <label>Icon Filename</label>
                <input type="text" name="icon_filename" placeholder="e.g. facebook.png">
                <div class="overlay-actions">
                    <button type="submit">Save</button>
                    <button type="button" onclick="closeAddOverlay()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="edit-overlay" class="overlay hidden">
        <div class="overlay-content">
            <h3>Edit Credential</h3>
            <form method="POST" action="/update">
                <input type="hidden" name="id" id="edit-id">
                <label>App Name</label>
                <input type="text" name="app_name" id="edit-app-name" required>
                <label>Username</label>
                <input type="text" name="username" id="edit-username" required>
                <label>Password</label>
                <input type="text" name="password" id="edit-password" required>
                <label>Email</label>
                <input type="email" name="email" id="edit-email">
                <label>Phone</label>
                <input type="text" name="phone" id="edit-phone">
                <label>Icon Filename</label>
                <input type="text" name="icon_filename" id="edit-icon">
                <div class="overlay-actions">
                    <button type="submit">Update</button>
                    <button type="button" onclick="closeEditOverlay()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="delete-confirm" class="overlay hidden">
        <div class="overlay-content">
            <h3>Confirm Delete</h3>
            <p>Are you sure you want to delete <strong id="delete-app-name"></strong>?</p>
            <form method="POST" action="/delete">
                <input type="hidden" name="id" id="delete-id">
                <div class="overlay-actions">
                    <button type="submit">Delete</button>
                    <button type="button" onclick="closeDeleteConfirm()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="logout-confirm" class="overlay hidden">
        <div class="overlay-content">
            <h3>Confirm Logout</h3>
            <p>Are you sure you want to logout?</p>
            <div class="overlay-actions">
                <button onclick="window.location.href='/logout'">Logout</button>
                <button onclick="closeLogoutConfirm()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        function openOverlay(app, user, pass, email, phone) {
            document.getElementById('overlay-app-name').textContent = app;
            document.getElementById('overlay-username').textContent = user;
            document.getElementById('overlay-password').textContent = pass;
            document.getElementById('overlay-email').textContent = email;
            document.getElementById('overlay-phone').textContent = phone;
            document.getElementById('app-overlay').classList.remove('hidden');
            document.getElementById('app-overlay').classList.add('visible');
        }

        function closeOverlay() {
            document.getElementById('app-overlay').classList.remove('visible');
            document.getElementById('app-overlay').classList.add('hidden');
        }

        function copyPassword() {
            const password = document.getElementById('overlay-password').textContent;
            navigator.clipboard.writeText(password);
        }

        function openProfile() {
            document.getElementById('profile-overlay').classList.remove('hidden');
            document.getElementById('profile-overlay').classList.add('visible');
        }

        function closeProfile() {
            document.getElementById('profile-overlay').classList.remove('visible');
            document.getElementById('profile-overlay').classList.add('hidden');
        }

        function openAddOverlay() {
            document.getElementById('add-overlay').classList.remove('hidden');
            document.getElementById('add-overlay').classList.add('visible');
        }

        function closeAddOverlay() {
            document.getElementById('add-overlay').classList.remove('visible');
            document.getElementById('add-overlay').classList.add('hidden');
        }

        function openEditOverlay(id, app, user, pass, email, phone, icon) {
            document.getElementById('edit-id').value = id;
            document.getElementById('edit-app-name').value = app;
            document.getElementById('edit-username').value = user;
            document.getElementById('edit-password').value = pass;
            document.getElementById('edit-email').value = email;
            document.getElementById('edit-phone').value = phone;
            document.getElementById('edit-icon').value = icon;
            document.getElementById('edit-overlay').classList.remove('hidden');
            document.getElementById('edit-overlay').classList.add('visible');
        }

        function closeEditOverlay() {
            document.getElementById('edit-overlay').classList.remove('visible');
            document.getElementById('edit-overlay').classList.add('hidden');
        }

        function openDeleteConfirm(id, appName) {
            document.getElementById('delete-id').value = id;
            document.getElementById('delete-app-name').textContent = appName;
            document.getElementById('delete-confirm').classList.remove('hidden');
            document.getElementById('delete-confirm').classList.add('visible');
        }

        function closeDeleteConfirm() {
            document.getElementById('delete-confirm').classList.remove('visible');
            document.getElementById('delete-confirm').classList.add('hidden');
        }

        function openLogoutConfirm() {
            document.getElementById('logout-confirm').classList.remove('hidden');
            document.getElementById('logout-confirm').classList.add('visible');
        }

        function closeLogoutConfirm() {
            document.getElementById('logout-confirm').classList.remove('visible');
            document.getElementById('logout-confirm').classList.add('hidden');
        }

        document.getElementById('search-box').addEventListener('input', function () {
            const query = this.value.toLowerCase();
            const cards = document.querySelectorAll('.app-card');

            cards.forEach(card => {
                const name = card.getAttribute('data-app-name');
                card.style.display = name.includes(query) ? 'flex' : 'none';
            });
        });

    </script>
</body>

</html>